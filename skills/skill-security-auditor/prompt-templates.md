# Skill Security Auditor - 提示词模板

## 概述

本文档包含Skill Security Auditor使用的所有提示词模板。这些模板用于分析技能文件内容并识别安全风险。

## 1. 主审计提示词模板

### 1.1 完整安全审计模板
```
# 技能安全审计分析

## 审计目标
对以下技能进行全面的安全审计，识别潜在的安全风险并提供修复建议。

## 技能信息
- 技能名称: {skill_name}
- 技能路径: {skill_path}
- 文件数量: {file_count}
- 总代码行数: {total_lines}

## 技能文件内容
{file_contents_summary}

## 审计要求
请基于以下安全规则进行分析：

### 1. API密钥和敏感信息泄露
- 检查硬编码的API密钥、令牌、密码
- 查找配置文件中的敏感信息
- 识别.env文件中的明文凭证
- 检测数据库连接字符串

### 2. 命令执行风险
- 识别危险的系统命令执行（如os.system, subprocess, exec）
- 检查用户输入直接用于命令执行
- 查找shell注入漏洞
- 分析文件上传和执行权限

### 3. 文件系统权限
- 检查不安全的文件读写操作
- 识别路径遍历漏洞
- 分析文件权限设置
- 检查临时文件处理

### 4. 网络访问控制
- 分析外部API调用
- 检查未验证的URL访问
- 识别SSRF（服务器端请求伪造）风险
- 检查网络请求中的敏感信息

### 5. 依赖安全分析
- 检查requirements.txt中的依赖版本
- 识别已知漏洞的依赖包
- 分析package.json中的依赖
- 检查自定义脚本的安全性

### 6. 权限提升风险
- 识别可能的权限提升漏洞
- 检查特权操作
- 分析环境变量访问
- 检查配置修改权限

## 输出格式要求
请按以下格式输出审计报告：

### 技能基本信息
- 技能名称: 
- 审计时间: 
- 文件数量: 
- 总代码行数: 

### 安全审计结果
#### 高风险问题 (红色)
1. [问题描述]
   - 位置: 
   - 风险描述: 
   - 修复建议: 

#### 中风险问题 (黄色)
1. [问题描述]
   - 位置: 
   - 风险描述: 
   - 修复建议: 

#### 低风险问题 (蓝色)
1. [问题描述]
   - 位置: 
   - 风险描述: 
   - 修复建议: 

#### 安全最佳实践 (绿色)
1. [实践描述]
   - 位置: 
   - 说明: 

### 总体安全评分
- 安全评分: X/10
- 风险等级: [高/中/低]
- 建议: 

### 详细修复建议
1. [具体修复步骤]
2. [安全配置建议]
3. [监控建议]
```

### 1.2 快速安全扫描模板
```
# 技能快速安全扫描

## 扫描目标
对技能进行快速安全扫描，识别最紧急的安全问题。

## 技能信息
{skill_basic_info}

## 扫描重点
1. 硬编码的API密钥和密码
2. 危险的命令执行
3. 明显的文件系统漏洞
4. 外部API调用风险

## 输出要求
列出发现的关键安全问题，按风险等级排序。
```

## 2. 专项审计提示词模板

### 2.1 API密钥泄露检测模板
```
# API密钥和敏感信息泄露检测

## 检测目标
在以下代码中查找硬编码的API密钥、令牌、密码等敏感信息：

{code_content}

## 检测规则
1. 查找以下模式：
   - API_KEY = ".*"
   - password = ".*"
   - token = ".*"
   - secret = ".*"
   - credential = ".*"
   - .env文件中的键值对
   - 配置文件中的敏感信息

2. 检查以下文件类型：
   - .py文件中的字符串常量
   - .json配置文件
   - .yaml/.yml配置文件
   - .env环境文件
   - 任何包含"key", "secret", "password"的文件

## 输出格式
### 发现的敏感信息
1. [敏感信息类型]
   - 位置: 文件:行号
   - 内容: [隐藏部分内容]
   - 风险: [高/中/低]
   - 建议: 
```

### 2.2 命令执行风险检测模板
```
# 命令执行风险检测

## 检测目标
在以下代码中查找危险的命令执行：

{code_content}

## 检测规则
1. 查找以下函数调用：
   - os.system()
   - subprocess.call()
   - subprocess.Popen()
   - exec()
   - eval()
   - os.popen()
   - commands.getoutput()

2. 检查用户输入是否直接用于命令执行
3. 查找shell=True的使用
4. 检查命令拼接操作

## 风险等级
- 高风险: 用户输入直接用于命令执行
- 中风险: 固定命令但可能被滥用
- 低风险: 安全的系统调用

## 输出格式
### 发现的命令执行风险
1. [风险描述]
   - 位置: 文件:行号
   - 代码片段: 
   - 风险等级: 
   - 修复建议: 
```

### 2.3 文件系统权限检测模板
```
# 文件系统权限检测

## 检测目标
在以下代码中查找不安全的文件操作：

{code_content}

## 检测规则
1. 查找以下操作：
   - 文件读写权限设置
   - 路径遍历漏洞（../）
   - 临时文件处理
   - 文件上传功能
   - 文件删除操作

2. 检查以下问题：
   - 硬编码文件路径
   - 用户输入直接用于文件路径
   - 不安全的权限设置（如0777）
   - 未验证的文件类型

## 输出格式
### 发现的文件系统风险
1. [风险描述]
   - 位置: 文件:行号
   - 代码片段: 
   - 风险等级: 
   - 修复建议: 
```

### 2.4 依赖安全分析模板
```
# 依赖包安全分析

## 分析目标
分析以下依赖文件的安全性：

{dependency_files}

## 分析规则
1. 检查requirements.txt：
   - 过时的依赖版本
   - 已知漏洞的包
   - 未指定版本的依赖

2. 检查package.json：
   - 开发依赖中的安全问题
   - 脚本命令的安全性
   - 依赖版本范围

3. 检查其他依赖文件：
   - Pipfile
   - poetry.lock
   - setup.py
   - setup.cfg

## 输出格式
### 依赖安全分析结果
1. [依赖包名称]
   - 版本: 
   - 已知漏洞: [是/否]
   - 漏洞描述: 
   - 建议版本: 
```

## 3. 报告生成模板

### 3.1 详细审计报告模板
```
# 技能安全审计报告

## 报告信息
- 报告ID: {report_id}
- 生成时间: {timestamp}
- 审计工具: Skill Security Auditor v1.0.0

## 执行摘要
{executive_summary}

## 技能概况
{skill_overview}

## 审计发现
### 高风险问题
{high_risk_issues}

### 中风险问题
{medium_risk_issues}

### 低风险问题
{low_risk_issues}

### 安全最佳实践
{best_practices}

## 技术详情
### 文件分析详情
{file_analysis_details}

### 代码片段分析
{code_snippet_analysis}

## 风险评估
### 风险矩阵
{risk_matrix}

### 影响分析
{impact_analysis}

## 修复建议
### 立即修复
{immediate_fixes}

### 短期改进
{short_term_improvements}

### 长期加固
{long_term_hardening}

## 附录
### 审计范围
{audit_scope}

### 方法学
{methodology}

### 限制说明
{limitations}
```

### 3.2 简洁审计报告模板
```
# 技能安全审计简报

## 基本信息
- 技能: {skill_name}
- 审计时间: {audit_time}
- 总体评分: {score}/10

## 关键发现
### 🔴 高风险 (需立即修复)
{critical_findings}

### 🟡 中风险 (建议修复)
{medium_findings}

### 🟢 低风险 (可计划修复)
{low_findings}

## 修复优先级
1. [最高优先级修复]
2. [中等优先级修复]
3. [低优先级修复]

## 下一步行动
- 立即行动: 
- 一周内完成: 
- 一个月内完成: 
```

## 4. 工具使用提示词

### 4.1 文件读取和分析提示词
```
请读取并分析以下技能目录中的所有文件：

技能路径: {skill_path}

请执行以下操作：
1. 列出所有文件及其类型
2. 读取主要代码文件内容
3. 分析配置文件
4. 检查依赖文件
5. 识别潜在的安全风险

输出格式：
### 文件列表
- [文件路径] (文件类型) [大小]

### 关键文件内容
[文件1摘要]
[文件2摘要]

### 初步安全观察
[观察1]
[观察2]
```

### 4.2 特定文件分析提示词
```
请详细分析以下文件的安全性：

文件路径: {file_path}
文件内容:
{file_content}

请关注：
1. API密钥和敏感信息
2. 命令执行风险
3. 文件系统操作
4. 网络请求
5. 依赖导入

输出发现的安全问题，按风险等级排序。
```

## 5. 风险评估矩阵

### 5.1 风险等级定义模板
```
## 风险等级定义

### 🔴 高风险 (严重)
- 影响: 可能导致系统完全被控制、数据泄露、服务中断
- 可能性: 高
- 修复优先级: 立即

### 🟡 中风险 (重要)
- 影响: 可能导致部分功能受损、信息泄露
- 可能性: 中等
- 修复优先级: 高

### 🟢 低风险 (一般)
- 影响: 影响有限，可能被利用但后果不严重
- 可能性: 低
- 修复优先级: 中等

### 🔵 信息性 (建议)
- 影响: 安全最佳实践，无直接风险
- 可能性: 无
- 修复优先级: 低
```

### 5.2 风险评分模板
```
## 安全评分标准

### 评分维度 (每项0-2分)
1. API密钥安全 (0-2分)
   - 2分: 无硬编码密钥，使用安全存储
   - 1分: 少量硬编码但非生产环境
   - 0分: 生产环境硬编码密钥

2. 命令执行安全 (0-2分)
   - 2分: 无危险命令执行，输入验证完善
   - 1分: 有限命令执行但有防护
   - 0分: 用户输入直接用于命令执行

3. 文件系统安全 (0-2分)
   - 2分: 安全的文件操作，权限控制严格
   - 1分: 基本文件操作，有基本防护
   - 0分: 不安全的文件操作，路径遍历风险

4. 网络安全 (0-2分)
   - 2分: 安全的网络请求，验证完善
   - 1分: 基本网络防护
   - 0分: 未验证的外部请求

5. 依赖安全 (0-2分)
   - 2分: 依赖版本固定，无已知漏洞
   - 1分: 部分依赖有更新建议
   - 0分: 使用有已知漏洞的依赖

### 总体评分
- 9-10分: 优秀
- 7-8分: 良好
- 5-6分: 一般
- 3-4分: 较差
- 0-2分: 危险
```

## 使用说明

1. 根据审计需求选择合适的模板
2. 替换模板中的变量（如{skill_name}、{file_content}等）
3. 结合具体技能内容进行分析
4. 根据实际情况调整模板内容
5. 保存审计结果供后续参考

## 模板更新

定期更新提示词模板以适应新的安全威胁和最佳实践。建议每季度审查和更新一次模板。